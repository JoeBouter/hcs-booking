<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom Booking System</title>
    <style>
        /* ===================== GLOBAL STYLES ===================== */
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        h2, h3, h4 {
            color: #333;
        }
        button {
            padding: 8px 15px;
            margin: 5px;
            background-color: var(--primaryColor, #4CAF50);
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #333;
        }
        input, select, textarea {
            padding: 5px;
            margin: 5px;
        }
        .hidden {
            display: none;
        }
        nav button {
            background-color: #ddd;
            color: black;
        }
        nav button.active {
            background-color: var(--primaryColor, #4CAF50);
            color: white;
        }
        hr {
            margin-top: 15px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

<!-- ===================== TOP NAVIGATION ===================== -->
<nav>
    <button onclick="showScreen('loginScreen')">Login</button>
    <button onclick="showScreen('registerScreen')">Register</button>
    <button onclick="showScreen('appScreen')">App</button>
</nav>

<!-- ===================== LOGIN SCREEN ===================== -->
<section id="loginScreen">
    <h2>Login</h2>
    <input type="text" id="loginUsername" placeholder="Username"><br>
    <input type="password" id="loginPassword" placeholder="Password"><br>
    <button onclick="login()">Login</button>
    <button onclick="showScreen('registerScreen')">Register New Site</button>
</section>

<!-- ===================== REGISTER SCREEN ===================== -->
<section id="registerScreen" class="hidden">
    <h2>Register New Site</h2>
    <input type="text" id="registerSite" placeholder="Site Name"><br>
    <input type="text" id="registerUsername" placeholder="Admin Username"><br>
    <input type="password" id="registerPassword" placeholder="Password"><br>
    <button onclick="register()">Register</button>
</section>

<!-- ===================== APP SCREEN ===================== -->
<section id="appScreen" class="hidden">
    <h2>Welcome, <span id="currentUser"></span></h2>
    <button onclick="logout()">Logout</button>
    <hr>

    <!-- INTERNAL TABS -->
    <nav>
        <button onclick="showAppTab('adminTab')" id="tabAdmin">Admin Panel</button>
        <button onclick="showAppTab('bookingTab')" id="tabBooking">Room Booking</button>
        <button onclick="showAppTab('calendarTab')" id="tabCalendar">Calendar</button>
    </nav>

    <!-- ===================== ADMIN PANEL ===================== -->
    <div id="adminTab">
        <h3>Admin Panel</h3>

        <!-- Export/Import -->
        <button onclick="exportData()">Export Data</button>
        <input type="file" onchange="importData(event)"><br><br>

        <!-- Site Color -->
        <h4>Site Color</h4>
        <input type="color" id="siteColorPicker" value="#4CAF50" onchange="changeSiteColor()"><br><br>

        <!-- Create Room -->
        <h4>Create Room</h4>
        <input type="text" id="newRoomName" placeholder="Room name">
        <button onclick="addRoom()">Add Room</button>
        <ul id="roomList"></ul><br>

        <!-- Bulk User Creation -->
        <h4>Bulk User Creation</h4>
        <textarea id="bulkUserInput" rows="4" placeholder="Format: S,username,password, T,username,password, A,username,password"></textarea><br>
        <button onclick="createUsers()">Create Users</button>
    </div>

    <!-- ===================== ROOM BOOKING ===================== -->
    <div id="bookingTab" class="hidden">
        <h3>Book a Room</h3>
        <input type="date" id="date"><br>
        <select id="room"></select><br>
        <select id="period">
            <option>Period 1</option>
            <option>Period 2</option>
            <option>Period 3</option>
            <option>Lunch</option>
            <option>Period 4</option>
        </select><br>
        <button onclick="book()">Submit Booking</button>
        <ul id="pendingList"></ul>
    </div>

    <!-- ===================== CALENDAR ===================== -->
    <div id="calendarTab" class="hidden">
        <h3>Booking Calendar</h3>
        <div id="calendar"></div>
    </div>
</section>

<!-- ===================== JAVASCRIPT ===================== -->
<script>
/* ===================== GLOBAL DATA ===================== */
let sites = JSON.parse(localStorage.getItem('sites')) || {};
let currentSite = null;
let currentUser = null;
let rooms = [];
let bookings = [];
let pending = [];
let siteColor = "#4CAF50";

/* ===================== SCREEN MANAGEMENT ===================== */
function showScreen(screen) {
    ['loginScreen', 'registerScreen', 'appScreen'].forEach(id => {
        document.getElementById(id).style.display = 'none';
    });
    document.getElementById(screen).style.display = 'block';
    if (screen === 'appScreen') {
        showAppTab('adminTab');
    }
}

/* ===================== APP TAB MANAGEMENT ===================== */
function showAppTab(tabId) {
    ['adminTab', 'bookingTab', 'calendarTab'].forEach(id => {
        document.getElementById(id).style.display = 'none';
        document.getElementById('tab' + id.replace('Tab', '')).classList.remove('active');
    });
    document.getElementById(tabId).style.display = 'block';
    document.getElementById('tab' + tabId.replace('Tab', '')).classList.add('active');
}

/* ===================== REGISTRATION ===================== */
function register() {
    const site = document.getElementById('registerSite').value.trim();
    const user = document.getElementById('registerUsername').value.trim();
    const pass = document.getElementById('registerPassword').value;
    if (!site || !user || !pass) return alert("Fill all fields");
    if (sites[site]) return alert("Site exists");
    sites[site] = {
        users: [{username: user, password: pass, role: "admin"}],
        rooms: [],
        bookings: [],
        pending: [],
        color: "#4CAF50"
    };
    localStorage.setItem('sites', JSON.stringify(sites));
    alert("Site registered!");
    showScreen('loginScreen');
}

/* ===================== LOGIN ===================== */
function login() {
    const user = document.getElementById('loginUsername').value.trim();
    const pass = document.getElementById('loginPassword').value;
    for (let site in sites) {
        const u = sites[site].users.find(u => u.username === user && u.password === pass);
        if (u) {
            currentSite = site;
            currentUser = u;
            enterApp();
            return;
        }
    }
    alert("Invalid login");
}

/* ===================== ENTER APP ===================== */
function enterApp() {
    document.getElementById('currentUser').textContent = `${currentUser.username} (${currentUser.role})`;
    rooms = sites[currentSite].rooms;
    bookings = sites[currentSite].bookings;
    pending = sites[currentSite].pending;
    siteColor = sites[currentSite].color;
    document.documentElement.style.setProperty('--primaryColor', siteColor);
    document.getElementById('siteColorPicker').value = siteColor;
    showScreen('appScreen');
    renderRooms();
    renderCalendar();
}

/* ===================== LOGOUT ===================== */
function logout() {
    currentSite = null;
    currentUser = null;
    showScreen('loginScreen');
}

/* ===================== CHANGE SITE COLOR ===================== */
function changeSiteColor() {
    siteColor = document.getElementById('siteColorPicker').value;
    sites[currentSite].color = siteColor;
    document.documentElement.style.setProperty('--primaryColor', siteColor);
    saveData();
}

/* ===================== ROOM MANAGEMENT ===================== */
function addRoom() {
    const name = document.getElementById('newRoomName').value.trim();
    if (!name || rooms.includes(name)) return alert("Invalid or duplicate room");
    rooms.push(name);
    renderRooms();
    saveData();
}

function renderRooms() {
    const roomList = document.getElementById('roomList');
    roomList.innerHTML = '';
    rooms.forEach(room => {
        const li = document.createElement('li');
        li.textContent = room;
        roomList.appendChild(li);
    });

    const roomSelect = document.getElementById('room');
    roomSelect.innerHTML = '';
    rooms.forEach(room => {
        const opt = document.createElement('option');
        opt.textContent = room;
        roomSelect.appendChild(opt);
    });
}

/* ===================== USER MANAGEMENT ===================== */
function createUsers() {
    const input = document.getElementById('bulkUserInput').value;
    const parts = input.split(',').map(x => x.trim());
    for (let i = 0; i < parts.length; i += 3) {
        const role = parts[i];
        const username = parts[i + 1];
        const password = parts[i + 2];
        sites[currentSite].users.push({username, password, role});
    }
    saveData();
    alert("Users added");
}

/* ===================== BOOKING ===================== */
function book() {
    const date = document.getElementById('date').value;
    const room = document.getElementById('room').value;
    const period = document.getElementById('period').value;
    pending.push({date, room, period, teacher: currentUser.username});
    renderPending();
    saveData();
}

function renderPending() {
    const list = document.getElementById('pendingList');
    list.innerHTML = '';
    pending.forEach(b => {
        const li = document.createElement('li');
        li.textContent = `${b.date} – ${b.room} – ${b.period} – ${b.teacher}`;
        list.appendChild(li);
    });
}

/* ===================== CALENDAR ===================== */
function renderCalendar() {
    const cal = document.getElementById('calendar');
    cal.innerHTML = '';
    for (let i = 1; i <= 30; i++) {
        const date = `2025-05-${String(i).padStart(2, '0')}`;
        const day = document.createElement('div');
        const todaysBookings = bookings.filter(b => b.date === date);
        day.innerHTML = `<strong>May ${i}</strong><br>` + 
            (todaysBookings.length ? todaysBookings.map(b => `${b.room} – ${b.period} – ${b.teacher}`).join('<br>') : 'No bookings');
        cal.appendChild(day);
    }
}

/* ===================== EXPORT/IMPORT ===================== */
function exportData() {
    const data = JSON.stringify(sites[currentSite]);
    const blob = new Blob([data], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${currentSite}.json`;
    a.click();
}

function importData(event) {
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = () => {
        sites[currentSite] = JSON.parse(reader.result);
        saveData();
        enterApp();
    };
    reader.readAsText(file);
}

/* ===================== SAVE ===================== */
function saveData() {
    sites[currentSite].rooms = rooms;
    sites[currentSite].bookings = bookings;
    sites[currentSite].pending = pending;
    localStorage.setItem('sites', JSON.stringify(sites));
}

/* ===================== PLACEHOLDER FOR FUTURE SERVER ===================== */
// Server-side storage will go here later!

</script>

</body>
</html>
